function AudioPlayer(t){this.audioPlayer=document.getElementsByClassName("audio_player")[0],this.playBtn=this.audioPlayer.getElementsByClassName("icon-play3")[0],this.audio=this.audioPlayer.getElementsByTagName("audio")[0],this.audioPannel=this.audioPlayer.getElementsByClassName("audio_pannel")[0],this.pauseClass="icon-pause2",this.playClass="icon-play3",this.mutedClass="muted",this.audio.volume=.5,this.index=0,this.way=3,this.json=t,this.num=this.json.num,this.List=this.audioPlayer.getElementsByClassName("list")[0],this.aLi=null,this.playWayBtns=null,this.status_bar=this.audioPlayer.getElementsByClassName("status_bar")[0],this.volume_ctrl=this.audioPannel.getElementsByClassName("volume_ctrl")[0],this.dot=this.audioPlayer.getElementsByClassName("dot")[0],this.timeShow=this.audioPlayer.getElementsByClassName("time_show")[0],this.liHeight=30,this.flag=!1,this.formats=["mp3","ogg","wav"],this.doInit()}AudioPlayer.prototype={doInit:function(){return this.creatList(),this.setAppDrag(),this.setControllor(),this.setDefault(),this},setAppDrag:function(){var t=this;drag(t.audioPlayer,null,!1)},setDefault:function(){var t=this;t._volumeUpdate(),t._playWaySwitch()},setControllor:function(){var t=this,e=t.audioPlayer.getElementsByClassName("volume")[0],a=t.audioPlayer.getElementsByClassName("time_go")[0],i=t.audioPlayer.getElementsByClassName("time_line")[0],s=t.audioPlayer.getElementsByClassName("icon-backward2")[0],o=t.audioPlayer.getElementsByClassName("icon-forward3")[0];e.onclick=function(){t.audio.muted?removeClass(this,"muted"):addClass(this,"muted"),t.audio.muted=!t.audio.muted},t.playBtn.onclick=function(){t.audio.paused?(t.audio.play(),this.className=t.pauseClass):(t.audio.pause(),this.className=t.playClass),t._highlightShow()};var n=t.audioPlayer.getElementsByClassName("time_dot")[0];t.audio.ontimeupdate=function(){var e=t.audio.currentTime/t.audio.duration,s=i.offsetWidth*e;a.style.width=s+"px",n.style.left=s-n.offsetWidth/2+"px",t._volumeUpdate(),t.timeShow.innerHTML=t._timeFormat(t.audio.currentTime)+"/"+t._timeFormat(t.audio.duration),t.audio.ended&&o.onclick()},n.onmousedown=function(e){var e=e||window.event,s=e.clientX-this.offsetLeft;stopBubble(e),document.onmousemove=function(e){var e=e||window.event,o=e.clientX-s;0>o?o=0:o>i.offsetWidth-n.offsetWidth&&(o=i.offsetWidth-n.offsetWidth),n.style.left=o+"px";var l=o/i.offsetWidth;t.audio.currentTime=l*t.audio.duration,a.style.width=n.offsetWidth/2+o+"px"},document.onmouseup=function(){this.onmousemove=null,this.onmouseup=null}};for(var l=0;l<t.aLi.length;l++)t.aLi[l].onclick=function(e){return function(){t._loadSource(this.getAttribute("mdUrl")),t.audio.play(),t.index=e,t._highlightShow(),t.playBtn.className=t.pauseClass}}(l);t.dot.onmousedown=function(a){var a=a||window.event,i=a.clientX-this.offsetLeft;stopBubble(a),document.onmousemove=function(a){var a=a||window.event,s=a.clientX-i;0>s?s=0:s>t.status_bar.offsetWidth-t.dot.offsetWidth&&(s=t.status_bar.offsetWidth-t.dot.offsetWidth),0==s?(t.audio.muted=!0,addClass(e,t.mutedClass)):(t.audio.muted=!1,removeClass(e,t.mutedClass)),t.dot.style.left=s+"px",t.volume_ctrl.style.width=s+t.dot.offsetWidth/2+"px";var o=s/(t.status_bar.offsetWidth-t.dot.offsetWidth);t.audio.volume=o},document.onmouseup=function(){this.onmousemove=null,this.onmouseup=null}},s.onclick=function(){switch(t.way){case 1:case 2:t.index--,t.index<0&&(t.index=t.num-1);break;case 3:do{var e=parseInt(Math.random()*t.num);t.index=e}while(e!=t.index)}t._loadSource(t.aLi[t.index].getAttribute("mdUrl")),t.audio.play(),t._highlightShow()},o.onclick=function(){switch(t.way){case 1:case 2:t.index++,t.index==t.num&&(t.index=0);break;case 3:do{var e=parseInt(Math.random()*t.num);t.index=e}while(e!=t.index)}t._loadSource(t.aLi[t.index].getAttribute("mdUrl")),t.audio.play(),t._highlightShow()};var u=t.audioPlayer.getElementsByClassName("play_way")[0];t.playWayBtns=u.getElementsByTagName("li"),u.onclick=function(){t.way++,t.way-1==t.playWayBtns.length&&(t.way=1),t._playWaySwitch()}},_timeFormat:function(t){function e(t){return 10>t?"0"+t:t}var a=parseInt(t/60),i=parseInt(t%60);return e(a)+":"+e(i)},_loadSource:function(t){function e(t){var e=a(),i={Opera:["ogg","wav"],Firefox:["ogg","wav"],Chrome:["ogg","mp3"],Safari:["mp3","wav"],IE:["mp3"]};return inArray(i[e],t)?!0:!1}function a(){var t=navigator.userAgent,e=!1;return t.indexOf("Opera")>-1?(e=!0,"Opera"):t.indexOf("Firefox")>-1?"Firefox":t.indexOf("Chrome")>-1?"Chrome":t.indexOf("Safari")>-1?"Safari":t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!e?"IE":void 0}for(var i=this,s=i.formats,o=!0,n=0;n<s.length;n++)if(e(s[n])){if(i.audio.src=t+"."+s[n],o)return void(i.audio.src=t+"."+s[n]);i.audio.onemptied=function(){o=!1}}},_highlightShow:function(){var t=this;removeClass(t.aLi,"on"),addClass(t.aLi[t.index],"on")},_playWaySwitch:function(){var t=this;addClass(t.playWayBtns,"display_none"),removeClass(t.playWayBtns[t.way-1],"display_none")},_volumeUpdate:function(){var t=this,e=t.audio.volume*t.status_bar.offsetWidth;t.dot.style.left=e+"px",t.volume_ctrl.style.width=e+t.dot.offsetWidth/2+"px"},creatList:function(){for(var t=this,e=t.audioPlayer.getElementsByClassName("circle1")[0],a=t.json.list,i=document.createDocumentFragment(),s=0;s<t.num;s++){var o=document.createElement("li");o.innerHTML=s+1+"."+a[s].mdName,o.index=s,o.setAttribute("mdUrl",a[s].mdUrl),i.appendChild(o)}t.List.appendChild(i),t.aLi=t.List.getElementsByTagName("li"),e.onclick=function(){var e=t.liHeight*t.num;t.flag?startMove(t.List,{height:0,opacity:0},500,"Back easeInOut"):startMove(t.List,{height:e,opacity:1},500,"Elastic easeInOut"),t.flag=!t.flag}}};